{% extends "admin/change_form.html" %}

{% load i18n static admin_modify admin_urls %}

{% block extrastyle %}
	{{ adminform.media.css }}
	{{ block.super }}
{% endblock extrastyle %}

{% block content %}
	<form novalidate {% if has_file_field %}enctype="multipart/form-data" {% endif %}action="{{ form_url }}" method="post" id="{{ opts.model_name }}_form" onsubmit='enable()'>{% csrf_token %}{% block form_top %}{% endblock %}
		{% with adminform.form.fields_formset as formset %}
			<div id="advanced_filters">
				<h1>{% trans "Change advanced filter" %}:</h1>
					{% csrf_token %}
					{{ formset.management_form }}
					<!-- Fieldsets -->
					{% block field_sets %}
						{% for fieldset in adminform %}
							{% include "admin/includes/fieldset.html" %}
						{% endfor %}
					{% endblock %}
					<br/>
					<table id="{{ formset.prefix }}-group" data-rules-formset>
						<thead>
							<tr>
								{% for field in formset.fields %}
									<th style="color: black;">{{ field.label|capfirst }}</th>
								{% endfor %}
							</tr>
						</thead>
						<tbody>
							{% for form in formset %}
								<tr class="form-row {% cycle "row1" "row2" %} {% if forloop.last %}empty-form{% endif %}" id="{{ formset.prefix }}-{% if not forloop.last %}{{ forloop.counter0 }}{% else %}empty{% endif %}">
									{% for field in form.visible_fields %}
										<td{% if field.field.name %} class="field-{{ field.field.name }}"{% endif %}>
											{{ field }}
											{{ field.errors }}
										</td>
										{% endfor %}
								</tr>
							{% endfor %}
						</tbody>
					</table>
					<br />

				<!-- Submit-Row -->
				{% block submit_buttons_bottom %}
					{% submit_row %}
					<input method="POST" name="_save_goto" type="submit" value="{% trans "Save & Filter Now!" %}">
				{% endblock %}

				<!-- JS for prepopulated fields -->
				{% prepopulated_fields_js %}
				{{ adminform.media.js }}

				<script type="text/javascript" charset="utf-8">
					// using django's original jquery, initial formset
					var FORM_MODEL = '{% if adminform %}{{ adminform.form.instance.model }}{% endif %}';
					var MODEL_LABEL = '{{ app_label }}.{{ opts.model_name }}';
					var FILTER_FIELDS_OPERATORS = '{{ adminform.form.filter_fields_operators }}';
					var OTHER_MODELS_FIELDS = '{{ adminform.form.get_other_models_fields }}';
					var APP_LABEL = '{{ adminform.form.app_label }}';
					var ALL_QUERY_OPERATORS = '{{ adminform.form.all_query_operators }}';
					function enable() {
						$('.form-row select.query-operator').each(function() {
							var row = $(this).parents('tr');
							var op = row.find('.query-operator');
							op.prop('disabled', false);
						})
						return true;
					}
				</script>

				{% include "admin/common_js_init.html" with formset=formset %}
			</div>
		{% endwith %}
	</form>
{% endblock content %}